<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Zabbix on IT Notes</title><link>https://itzm.tech/tags/zabbix/</link><description>Recent content in Zabbix on IT Notes</description><generator>Hugo -- gohugo.io</generator><language>ru-ru</language><lastBuildDate>Thu, 30 Oct 2025 12:00:00 +0500</lastBuildDate><atom:link href="https://itzm.tech/tags/zabbix/index.xml" rel="self" type="application/rss+xml"/><item><title>Zabbix &amp; Grafana: Мониторинг сайта скриптами. Часть 2</title><link>https://itzm.tech/p/zabbix2/</link><pubDate>Thu, 30 Oct 2025 12:00:00 +0500</pubDate><guid>https://itzm.tech/p/zabbix2/</guid><description>&lt;img src="https://itzm.tech/p/zabbix2/zabbix2.jpg" alt="Featured image of post Zabbix &amp; Grafana: Мониторинг сайта скриптами. Часть 2" /&gt;&lt;p&gt;В продолжении мы настроим оповещение в Zabbix и визуализацию в Grafana&lt;/p&gt;
&lt;h2 id="шаг-5-настроить-оповещение"&gt;Шаг 5. Настроить оповещение
&lt;/h2&gt;&lt;p&gt;Добавляем адрес EMail SMTP сервера. Для этого переходим в:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Administration -&amp;gt; Media Types -&amp;gt; EMail&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Указываем настройки вашего SMTP сервера&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix2/11emailhtml.jpg"
width="821"
height="666"
loading="lazy"
class="gallery-image"
data-flex-grow="123"
data-flex-basis="295px"
&gt;&lt;/p&gt;
&lt;p&gt;Создаем группу:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Configuration -&amp;gt; User Groups -&amp;gt; Create&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Name: Alert only
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Permission: Read (Выдаём права на сервер, с которого собирается метрика, у меня Zabbix Server)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix2/12userperm.jpg"
width="1067"
height="362"
loading="lazy"
class="gallery-image"
data-flex-grow="294"
data-flex-basis="707px"
&gt;&lt;/p&gt;
&lt;p&gt;Создаем пользователя, который будет получать уведомления:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Administration -&amp;gt; Users -&amp;gt; New&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix2/13users.jpg"
width="865"
height="602"
loading="lazy"
class="gallery-image"
data-flex-grow="143"
data-flex-basis="344px"
&gt;&lt;/p&gt;
&lt;p&gt;В Media добавляем sms, Email (HTML)&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix2/14usermedia.jpg"
width="902"
height="277"
loading="lazy"
class="gallery-image"
data-flex-grow="325"
data-flex-basis="781px"
&gt;&lt;/p&gt;
&lt;p&gt;Переходим в созданную нами ранее группу и добавляем нашего пользователя &lt;code&gt;alert_user&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Configuration -&amp;gt; User Groups -&amp;gt; Alert only&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Users: -&amp;gt; Select alert_user
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;-&amp;gt; Operations&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Default: 1h
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Send to user groups: alert_user
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Send only to: Email (HTML)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix2/15usergroup.jpg"
width="1455"
height="36"
loading="lazy"
class="gallery-image"
data-flex-grow="4041"
data-flex-basis="9700px"
&gt;&lt;/p&gt;
&lt;p&gt;Настраиваем действие (Action) на триггер:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Configuration -&amp;gt; Action -&amp;gt; Create Action&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix2/16action.jpg"
width="808"
height="347"
loading="lazy"
class="gallery-image"
data-flex-grow="232"
data-flex-basis="558px"
&gt;&lt;/p&gt;
&lt;p&gt;Далее добавляем Operation:&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix2/17operat.jpg"
width="1019"
height="588"
loading="lazy"
class="gallery-image"
data-flex-grow="173"
data-flex-basis="415px"
&gt;&lt;/p&gt;
&lt;p&gt;Настройка выполнена.&lt;br&gt;
Можно изменить в скрипте из первой части &lt;code&gt;0&lt;/code&gt; и &lt;code&gt;1&lt;/code&gt; местами и проверить весь процесс срабатывания триггера и пересчёта SLA.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Дополнительно&lt;/code&gt;&lt;br&gt;
По желанию можно сделать отправку по Email (HTML). Кастомный шаблон.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix2/18.jpg"
width="768"
height="192"
loading="lazy"
class="gallery-image"
data-flex-grow="400"
data-flex-basis="960px"
&gt;&lt;/p&gt;
&lt;h2 id="шаг-7-визуализация-в-grafana"&gt;Шаг 7. Визуализация в Grafana
&lt;/h2&gt;&lt;p&gt;Предполагается, что к вашей Grafana уже подключен источник данных Zabbix. Здесь я это не затрагиваю.&lt;/p&gt;
&lt;p&gt;Создаём новую панель:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Dashboard -&amp;gt; New Add a new panel&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Выбираем:
&lt;code&gt;Query&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Data Source: Zabbix
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Type: Stat
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Count A:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - Query type: Triggers
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - Count by: All triggers
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - Group: Server
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - Min severity: Warning
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - Count: On
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Count B:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - Query type: Services
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - Service: SITE
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - SLA: SITE
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - Property: SLI
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Далее переходим в:
&lt;code&gt;Transform&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;span class="lnt"&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Rename by regex:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - Match: (Count A)
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - Replace: Status
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Rename by regex:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - Match: (Count B)
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - Replace: Available
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Filter by name:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - Count A
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - SLI SITE
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Настройка расположения и прочего - вкусовщина. Я делаю так:&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix2/20.jpg"
width="611"
height="448"
loading="lazy"
class="gallery-image"
data-flex-grow="136"
data-flex-basis="327px"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Итог:&lt;/code&gt;&lt;br&gt;
Раз в минуту zabbix-server будет обращаться к zabbix-agent для получения метрики. Сервер будет запускать скрипт, авторизовываться и возвращать значение параметра.&lt;br&gt;
Полученное значение отображается в Web-интерфейсе Zabbix, рассчитывается SLA. В Grafana выводится бизнес-метрика и значение в виде графика.&lt;br&gt;
Если авторизация не удается более 2-х раз, то срабатывает триггер, который отправляет по Email сообщение администратору.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix2/19.jpg"
width="800"
height="239"
loading="lazy"
class="gallery-image"
data-flex-grow="334"
data-flex-basis="803px"
&gt;&lt;/p&gt;</description></item><item><title>Zabbix &amp; Grafana: Мониторинг сайта скриптами. Часть 1</title><link>https://itzm.tech/p/zabbix1/</link><pubDate>Thu, 30 Oct 2025 11:45:00 +0500</pubDate><guid>https://itzm.tech/p/zabbix1/</guid><description>&lt;img src="https://itzm.tech/p/zabbix1/zabbix1.png" alt="Featured image of post Zabbix &amp; Grafana: Мониторинг сайта скриптами. Часть 1" /&gt;&lt;p&gt;&lt;code&gt;Дано:&lt;/code&gt; Критически важный сайт, который нужно мониторить и в случае неработоспособности уведомлять админов.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Версия Zabbix: 6.0.1&lt;/li&gt;
&lt;li&gt;Версия Grafana: 11.6.0&lt;/li&gt;
&lt;li&gt;Мониторинг будем настраивать на получение кода 200.&lt;br&gt;
Если авторизация удалась, то считаем это за 1, если нет, то 0.&lt;br&gt;
Запрос каждую минуту&lt;/li&gt;
&lt;li&gt;2-е неуспешные авторизации = срабатывание триггера&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;В первой части статьи мы создадим скрипт и настроим zabbix на сбор метрик.&lt;br&gt;
Во второй части сделаем оповещение пользователей Zabbix и визуализируем результаты мониторинга в Grafana.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;Порядок действий:&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Выбрать сервер, с установленным zabbix-агентом. Написать скрипт.&lt;/li&gt;
&lt;li&gt;Добавить пользовательский параметр в конфигурацию zabbix-агента&lt;/li&gt;
&lt;li&gt;Создать шаблон (элементы, триггеры) + назначить хосту (В моём примере это будет сам zabbix-сервер)&lt;/li&gt;
&lt;li&gt;Настроить SLA&lt;/li&gt;
&lt;li&gt;Настроить оповещения&lt;/li&gt;
&lt;li&gt;Создать пользователя (группу пользователей) для уведомлений + создание действия&lt;/li&gt;
&lt;li&gt;Визуализация в Grafana&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="шаг-1-выбрать-сервер-с-установленным-zabbix-агентом-написать-скрипт"&gt;Шаг 1. Выбрать сервер, с установленным zabbix-агентом. Написать скрипт.
&lt;/h2&gt;&lt;p&gt;В качестве сервера, который будет запускать скрипт и получать значение у меня будет Zabbix-сервер.
Захожу на сервер. Создаю скрипт:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sudo nano /opt/monitoring/site-check.py
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Пример написанного мною скрипта. Используется Python3 и библиотеки: &lt;code&gt;requests, sys, warnings&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://github.com/ZM56/auth_check/blob/main/site-check.py" target="_blank" rel="noopener"
&gt;Линк на Github&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Делаем исполняемым:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sudo chmod +x /opt/monitoring/site-check.py
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Меняем группу владельца на zabbix&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sudo chown root:zabbix /opt/monitoring/site-check.py
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Запускаем тестируем:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;./opt/monitoring/site-check.py
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix1/1scrtest.jpg"
width="418"
height="47"
loading="lazy"
class="gallery-image"
data-flex-grow="889"
data-flex-basis="2134px"
&gt;&lt;/p&gt;
&lt;h2 id="шаг-2-добавить-пользовательский-параметр-в-конфигурацию-zabbix-агента"&gt;Шаг 2. Добавить пользовательский параметр в конфигурацию zabbix-агента
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sudo nano /etc/zabbix/zabbix_agentd.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Находим параметр: &lt;code&gt;UserParameter&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Где, &lt;code&gt;site.auth&lt;/code&gt; - переменная, в которую будет записываться значение полученное после выполнения скрипта.
&lt;code&gt;/opt/monitoring/site-check.py&lt;/code&gt; - путь до скрипта.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-ini" data-lang="ini"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;UserParameter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;site.auth,/opt/monitoring/site-check.py&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix1/2userpar.jpg"
width="521"
height="132"
loading="lazy"
class="gallery-image"
data-flex-grow="394"
data-flex-basis="947px"
&gt;&lt;/p&gt;
&lt;p&gt;Рестартим сервис:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;systemctl restart zabbix-agent.service
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Проверяем, что zabbix понимает переменную:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;zabbix_agentd -t site.auth
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix1/3zabper.jpg"
width="447"
height="37"
loading="lazy"
class="gallery-image"
data-flex-grow="1208"
data-flex-basis="2899px"
&gt;&lt;/p&gt;
&lt;h2 id="шаг-3-создать-шаблон-элементы-триггеры--назначить-хосту"&gt;Шаг 3. Создать шаблон (элементы, триггеры) + назначить хосту
&lt;/h2&gt;&lt;p&gt;Идем в веб-интерфейс Zabbix. Создаём шаблон:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Templates -&amp;gt; Create template&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix1/4templ.jpg"
width="872"
height="445"
loading="lazy"
class="gallery-image"
data-flex-grow="195"
data-flex-basis="470px"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-&amp;gt; Add&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Создаем элемент:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Items -&amp;gt; Create item&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix1/5item.jpg"
width="850"
height="764"
loading="lazy"
class="gallery-image"
data-flex-grow="111"
data-flex-basis="267px"
&gt;&lt;/p&gt;
&lt;p&gt;Далее &lt;code&gt;Test&lt;/code&gt; -&amp;gt; &lt;code&gt;Host address&lt;/code&gt; Наш сервер, на котором запускается скрипт -&amp;gt; &lt;code&gt;Port: 10050&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;В Value появится &lt;code&gt;1&lt;/code&gt;, если авторизация доступна или &lt;code&gt;0&lt;/code&gt; если недоступна.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-&amp;gt; Add&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Создаем триггер&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Triggers -&amp;gt; Create Trigger&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix1/6trig.jpg"
width="819"
height="767"
loading="lazy"
class="gallery-image"
data-flex-grow="106"
data-flex-basis="256px"
&gt;&lt;/p&gt;
&lt;p&gt;Я закладываю логику: Если два раз подряд авторизация завершится неудачно, тогда срабатывает триггер.&lt;br&gt;
Напоминаю, что используется Zabbix 6.0 поэтому параметры типа count с тремя значениями использоваться ещё не могут. Будем брать последние 2 значения:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Expression: last(/Template Auth Monitoring/site.auth,#1)=0 and last(/Template Auth Monitoring/site.auth,#2)=0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;где, #1 = Последнее полученное значение ключа, #2 = Предпоследнее полученное значение ключа&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Далее переходим в Tag и назначаем&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix1/7trigtag.jpg"
width="901"
height="295"
loading="lazy"
class="gallery-image"
data-flex-grow="305"
data-flex-basis="733px"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-&amp;gt; Add&lt;/code&gt;&lt;/p&gt;
&lt;h2 id="шаг-4-настройка-sla"&gt;Шаг 4. Настройка SLA
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Service -&amp;gt; SLA -&amp;gt; Create SLA&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix1/8sla.jpg"
width="726"
height="623"
loading="lazy"
class="gallery-image"
data-flex-grow="116"
data-flex-basis="279px"
&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Reporting period&amp;#34; Quarterly # Считать статистику будем за квартал
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;code&gt;-&amp;gt; Add&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Создаём сервис&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Services -&amp;gt; Edit - Create service&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix1/9crserv.jpg"
width="714"
height="584"
loading="lazy"
class="gallery-image"
data-flex-grow="122"
data-flex-basis="293px"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-&amp;gt; Add&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Назначаем тег&lt;/p&gt;
&lt;p&gt;&lt;img src="https://itzm.tech/p/zabbix1/10svctag.jpg"
width="706"
height="261"
loading="lazy"
class="gallery-image"
data-flex-grow="270"
data-flex-basis="649px"
&gt;&lt;/p&gt;
&lt;p&gt;Настройка сбора метрик завершена. В следующей части оповещения и визуализация в Grafana.&lt;/p&gt;
&lt;p&gt;Часть 2 -&amp;gt; &lt;a class="link" href="https://itzm.tech/p/zabbix2/" target="_blank" rel="noopener"
&gt;https://itzm.tech/p/zabbix2/&lt;/a&gt;&lt;/p&gt;</description></item></channel></rss>